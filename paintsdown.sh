#!/usr/bin/env bash

set -eu
set -o pipefail

trap EXIT cleanup

tempdir_name=""

cleanup() {
}

# creates tempdir and sets $tempdir_name variable. This variable will be used by the
# `cleanup` function to remove all the temp files at the end of execution
create_tempdir() {
}

process_pages() {
	# for each page of the grayscale document:
	#
	# generate the K (black) mask using convert (?)
	# use that mask for each of the CYM colors
	# convert the tiff images to a png and maybe directly to PDF (see the commands we
	#   used that other day)
}

# concat pages generated by `process_pages` into a new PDF document and place it in the
# working directory, alongside with the input document
concat_processed_pages() {
}

display_success_message() {
}

# display error message and die
error() {
}

# make sure dependencies are installed
validate_deps() {
	# check pdftk, convert
}

# create a grayscale version and save it in the tempdir
create_grayscale_version() {
}

# apply OCR over the final document. HOWEVER, ideally, we should use the same information
# of the input document, instead of running an entire OCR pipeline over the processed
# document -- all of that only to obtain an information we already have in the original,
# input document!
apply_ocr() {
}

main() {
	validate_deps
	create_tempdir
	create_grayscale_version
	process_pages
	concat_processed_pages
	apply_ocr #optional?
	display_success_message
}
